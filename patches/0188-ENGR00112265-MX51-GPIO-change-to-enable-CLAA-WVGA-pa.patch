From 4fc7620186ec6ee133136dc11ab4b25034afa62c Mon Sep 17 00:00:00 2001
From: Liu Ying <b17645@freescale.com>
Date: Fri, 8 May 2009 14:34:01 +0800
Subject: [PATCH] ENGR00112265 MX51:GPIO change to enable CLAA WVGA panel

GPIO change to enable CLAA WVGA panel.

Signed-off-by: Liu Ying <b17645@freescale.com>
---
 arch/arm/mach-mx51/mx51_3stack.c      |   10 +++++++++-
 arch/arm/mach-mx51/mx51_3stack_gpio.c |    8 ++++++++
 2 files changed, 17 insertions(+), 1 deletions(-)

diff --git a/arch/arm/mach-mx51/mx51_3stack.c b/arch/arm/mach-mx51/mx51_3stack.c
index 9b29dbc..c9f0143 100644
--- a/arch/arm/mach-mx51/mx51_3stack.c
+++ b/arch/arm/mach-mx51/mx51_3stack.c
@@ -248,6 +248,7 @@ static struct platform_device mxc_fb_device[] = {
 
 static void lcd_reset_to2(void)
 {
+	mxc_set_gpio_dataout(MX51_PIN_DI1_D1_CS, 0);
 	ipu_reset_disp_panel();
 
 	return;
@@ -277,7 +278,14 @@ static struct platform_device mxc_lcd_device = {
 		},
 };
 
-static struct mxc_lcd_platform_data lcd_wvga_data;
+static void wvga_reset(void)
+{
+	mxc_set_gpio_dataout(MX51_PIN_DI1_D1_CS, 1);
+}
+
+static struct mxc_lcd_platform_data lcd_wvga_data = {
+	.reset = wvga_reset,
+};
 
 static struct platform_device lcd_wvga_device = {
 	.name = "lcd_claa",
diff --git a/arch/arm/mach-mx51/mx51_3stack_gpio.c b/arch/arm/mach-mx51/mx51_3stack_gpio.c
index 3064d1f..9c0d7fd 100644
--- a/arch/arm/mach-mx51/mx51_3stack_gpio.c
+++ b/arch/arm/mach-mx51/mx51_3stack_gpio.c
@@ -220,6 +220,9 @@ static struct mxc_iomux_pin_cfg __initdata mxc_iomux_pins[] = {
 	{
 	 MX51_PIN_DISPB2_SER_RS, IOMUX_CONFIG_GPIO,
 	 },
+	{
+	 MX51_PIN_DISPB2_SER_DIO, IOMUX_CONFIG_GPIO,
+	 },
 	{ /* TO2 */
 	MX51_PIN_DI1_D1_CS, IOMUX_CONFIG_ALT4,
 	},
@@ -700,5 +703,10 @@ void __init mx51_3stack_io_init(void)
 	/* osc_en is shared by SPDIF */
 	mxc_set_gpio_direction(MX51_PIN_EIM_D16, 0);
 	mxc_set_gpio_dataout(MX51_PIN_EIM_D16, 1);
+
+	/* LCD related gpio */
+	mxc_set_gpio_direction(MX51_PIN_DI1_D1_CS, 0);
+	mxc_set_gpio_direction(MX51_PIN_DISPB2_SER_DIO, 0);
+	mxc_set_gpio_dataout(MX51_PIN_DISPB2_SER_DIO, 0);
 }
 
-- 
1.5.4.4

