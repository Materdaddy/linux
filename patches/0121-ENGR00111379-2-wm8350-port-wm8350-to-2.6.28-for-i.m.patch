From 7f05c09cd8705291bde09100fda9f1fc83c46944 Mon Sep 17 00:00:00 2001
From: Alan Tull <r80115@freescale.com>
Date: Tue, 14 Apr 2009 09:42:32 -0500
Subject: [PATCH] ENGR00111379-2 wm8350: port wm8350 to 2.6.28 for i.mx37

Add support for wm8350 under 2.6.28 for i.Mx37 3stack platform.

Signed-off-by: Alan Tull <r80115@freescale.com>
---
 arch/arm/configs/imx37_3stack_defconfig      |  369 ++++++++++++-------
 arch/arm/mach-mx37/Kconfig                   |    1 +
 arch/arm/mach-mx37/mx37_3stack.c             |    3 +
 arch/arm/mach-mx37/mx37_3stack_pmic_wm8350.c |  508 +++++++++++---------------
 4 files changed, 442 insertions(+), 439 deletions(-)

diff --git a/arch/arm/configs/imx37_3stack_defconfig b/arch/arm/configs/imx37_3stack_defconfig
index 141871b..89c06fc 100644
--- a/arch/arm/configs/imx37_3stack_defconfig
+++ b/arch/arm/configs/imx37_3stack_defconfig
@@ -1,7 +1,7 @@
 #
 # Automatically generated make config: don't edit
-# Linux kernel version: 2.6.26
-# Fri Oct 24 15:23:40 2008
+# Linux kernel version: 2.6.28
+# Tue Apr 14 09:45:33 2009
 #
 CONFIG_ARM=y
 CONFIG_SYS_SUPPORTS_APM_EMULATION=y
@@ -12,6 +12,7 @@ CONFIG_MMU=y
 # CONFIG_NO_IOPORT is not set
 CONFIG_GENERIC_HARDIRQS=y
 CONFIG_STACKTRACE_SUPPORT=y
+CONFIG_HAVE_LATENCYTOP_SUPPORT=y
 CONFIG_LOCKDEP_SUPPORT=y
 CONFIG_TRACE_IRQFLAGS_SUPPORT=y
 CONFIG_HARDIRQS_SW_RESEND=y
@@ -21,9 +22,9 @@ CONFIG_RWSEM_GENERIC_SPINLOCK=y
 # CONFIG_ARCH_HAS_ILOG2_U64 is not set
 CONFIG_GENERIC_HWEIGHT=y
 CONFIG_GENERIC_CALIBRATE_DELAY=y
-CONFIG_ARCH_SUPPORTS_AOUT=y
 CONFIG_ZONE_DMA=y
 CONFIG_ARCH_MTD_XIP=y
+CONFIG_GENERIC_HARDIRQS_NO__DO_IRQ=y
 CONFIG_VECTORS_BASE=0xffff0000
 CONFIG_DEFCONFIG_LIST="/lib/modules/$UNAME_RELEASE/.config"
 
@@ -58,7 +59,6 @@ CONFIG_SYSCTL=y
 CONFIG_EMBEDDED=y
 CONFIG_UID16=y
 CONFIG_SYSCTL_SYSCALL=y
-CONFIG_SYSCTL_SYSCALL_CHECK=y
 CONFIG_KALLSYMS=y
 # CONFIG_KALLSYMS_EXTRA_PASS is not set
 CONFIG_HOTPLUG=y
@@ -74,6 +74,7 @@ CONFIG_SIGNALFD=y
 CONFIG_TIMERFD=y
 CONFIG_EVENTFD=y
 CONFIG_SHMEM=y
+CONFIG_AIO=y
 CONFIG_VM_EVENT_COUNTERS=y
 CONFIG_SLUB_DEBUG=y
 # CONFIG_SLAB is not set
@@ -85,8 +86,7 @@ CONFIG_HAVE_OPROFILE=y
 # CONFIG_KPROBES is not set
 CONFIG_HAVE_KPROBES=y
 CONFIG_HAVE_KRETPROBES=y
-# CONFIG_HAVE_DMA_ATTRS is not set
-CONFIG_PROC_PAGE_MONITOR=y
+CONFIG_HAVE_GENERIC_DMA_COHERENT=y
 CONFIG_SLABINFO=y
 CONFIG_RT_MUTEXES=y
 # CONFIG_TINY_SHMEM is not set
@@ -103,6 +103,7 @@ CONFIG_BLOCK=y
 # CONFIG_BLK_DEV_IO_TRACE is not set
 # CONFIG_LSF is not set
 # CONFIG_BLK_DEV_BSG is not set
+# CONFIG_BLK_DEV_INTEGRITY is not set
 
 #
 # IO Schedulers
@@ -117,6 +118,7 @@ CONFIG_DEFAULT_CFQ=y
 # CONFIG_DEFAULT_NOOP is not set
 CONFIG_DEFAULT_IOSCHED="cfq"
 CONFIG_CLASSIC_RCU=y
+CONFIG_FREEZER=y
 
 #
 # System Type
@@ -128,7 +130,6 @@ CONFIG_CLASSIC_RCU=y
 # CONFIG_ARCH_AT91 is not set
 # CONFIG_ARCH_CLPS7500 is not set
 # CONFIG_ARCH_CLPS711X is not set
-# CONFIG_ARCH_CO285 is not set
 # CONFIG_ARCH_EBSA110 is not set
 # CONFIG_ARCH_EP93XX is not set
 # CONFIG_ARCH_FOOTBRIDGE is not set
@@ -142,8 +143,11 @@ CONFIG_CLASSIC_RCU=y
 # CONFIG_ARCH_IXP2000 is not set
 # CONFIG_ARCH_IXP4XX is not set
 # CONFIG_ARCH_L7200 is not set
+# CONFIG_ARCH_KIRKWOOD is not set
 # CONFIG_ARCH_KS8695 is not set
 # CONFIG_ARCH_NS9XXX is not set
+# CONFIG_ARCH_LOKI is not set
+# CONFIG_ARCH_MV78XX0 is not set
 CONFIG_ARCH_MXC=y
 # CONFIG_ARCH_ORION5X is not set
 # CONFIG_ARCH_PNX4008 is not set
@@ -155,7 +159,7 @@ CONFIG_ARCH_MXC=y
 # CONFIG_ARCH_LH7A40X is not set
 # CONFIG_ARCH_DAVINCI is not set
 # CONFIG_ARCH_OMAP is not set
-# CONFIG_ARCH_MSM7X00A is not set
+# CONFIG_ARCH_MSM is not set
 
 #
 # Boot options
@@ -174,7 +178,6 @@ CONFIG_ARCH_MX37=y
 # CONFIG_ARCH_MX3 is not set
 # CONFIG_ARCH_MX27 is not set
 # CONFIG_ARCH_MX25 is not set
-# CONFIG_ARCH_MX21 is not set
 CONFIG_I2C_MXC_SELECT1=y
 CONFIG_I2C_MXC_SELECT2=y
 CONFIG_MXC_SDMA_API=y
@@ -198,6 +201,7 @@ CONFIG_ARCH_MXC_HAS_NFC_V3_1=y
 # Device options
 #
 CONFIG_MXC_TZIC=y
+CONFIG_ARCH_HAS_RNGC=y
 CONFIG_ARCH_HAS_EVTMON=y
 CONFIG_DMA_ZONE_SIZE=32
 CONFIG_UTMI_MXC=y
@@ -230,6 +234,8 @@ CONFIG_ARM_THUMB=y
 # CONFIG_CPU_BPREDICT_DISABLE is not set
 CONFIG_OUTER_CACHE=y
 CONFIG_CACHE_L2X0=y
+# CONFIG_ARM_ERRATA_364296 is not set
+CONFIG_ARM_ERRATA_411920=y
 
 #
 # Bus support
@@ -245,25 +251,31 @@ CONFIG_TICK_ONESHOT=y
 CONFIG_NO_HZ=y
 CONFIG_HIGH_RES_TIMERS=y
 CONFIG_GENERIC_CLOCKEVENTS_BUILD=y
+CONFIG_VMSPLIT_3G=y
+# CONFIG_VMSPLIT_2G is not set
+# CONFIG_VMSPLIT_1G is not set
+CONFIG_PAGE_OFFSET=0xC0000000
 CONFIG_PREEMPT=y
 CONFIG_HZ=100
 CONFIG_AEABI=y
 # CONFIG_OABI_COMPAT is not set
-# CONFIG_ARCH_DISCONTIGMEM_ENABLE is not set
+CONFIG_ARCH_FLATMEM_HAS_HOLES=y
+# CONFIG_ARCH_SPARSEMEM_DEFAULT is not set
+# CONFIG_ARCH_SELECT_MEMORY_MODEL is not set
 CONFIG_SELECT_MEMORY_MODEL=y
 CONFIG_FLATMEM_MANUAL=y
 # CONFIG_DISCONTIGMEM_MANUAL is not set
 # CONFIG_SPARSEMEM_MANUAL is not set
 CONFIG_FLATMEM=y
 CONFIG_FLAT_NODE_MEM_MAP=y
-# CONFIG_SPARSEMEM_STATIC is not set
-# CONFIG_SPARSEMEM_VMEMMAP_ENABLE is not set
 CONFIG_PAGEFLAGS_EXTENDED=y
 CONFIG_SPLIT_PTLOCK_CPUS=4
 # CONFIG_RESOURCES_64BIT is not set
+# CONFIG_PHYS_ADDR_T_64BIT is not set
 CONFIG_ZONE_DMA_FLAG=1
 CONFIG_BOUNCE=y
 CONFIG_VIRT_TO_BUS=y
+CONFIG_UNEVICTABLE_LRU=y
 # CONFIG_LEDS is not set
 CONFIG_ALIGNMENT_TRAP=y
 
@@ -277,7 +289,7 @@ CONFIG_CMDLINE="noinitrd console=ttymxc0,115200 root=/dev/mtdblock2 rw rootfstyp
 # CONFIG_KEXEC is not set
 
 #
-# CPU Frequency scaling
+# CPU Power Management
 #
 CONFIG_CPU_FREQ=y
 CONFIG_CPU_FREQ_TABLE=y
@@ -295,6 +307,7 @@ CONFIG_CPU_FREQ_GOV_USERSPACE=y
 # CONFIG_CPU_FREQ_GOV_ONDEMAND is not set
 # CONFIG_CPU_FREQ_GOV_CONSERVATIVE is not set
 CONFIG_CPU_FREQ_IMX=y
+# CONFIG_CPU_IDLE is not set
 
 #
 # Floating point emulation
@@ -309,6 +322,8 @@ CONFIG_VFP=y
 # Userspace binary formats
 #
 CONFIG_BINFMT_ELF=y
+# CONFIG_CORE_DUMP_DEFAULT_ELF_HEADERS is not set
+CONFIG_HAVE_AOUT=y
 # CONFIG_BINFMT_AOUT is not set
 # CONFIG_BINFMT_MISC is not set
 
@@ -322,10 +337,6 @@ CONFIG_SUSPEND=y
 CONFIG_SUSPEND_FREEZER=y
 # CONFIG_APM_EMULATION is not set
 CONFIG_ARCH_SUSPEND_POSSIBLE=y
-
-#
-# Networking
-#
 CONFIG_NET=y
 
 #
@@ -376,6 +387,7 @@ CONFIG_DEFAULT_TCP_CONG="cubic"
 # CONFIG_TIPC is not set
 # CONFIG_ATM is not set
 # CONFIG_BRIDGE is not set
+# CONFIG_NET_DSA is not set
 # CONFIG_VLAN_8021Q is not set
 # CONFIG_DECNET is not set
 # CONFIG_LLC2 is not set
@@ -394,6 +406,7 @@ CONFIG_NET_SCHED=y
 # CONFIG_NET_SCH_HTB is not set
 # CONFIG_NET_SCH_HFSC is not set
 # CONFIG_NET_SCH_PRIO is not set
+# CONFIG_NET_SCH_MULTIQ is not set
 # CONFIG_NET_SCH_RED is not set
 # CONFIG_NET_SCH_SFQ is not set
 # CONFIG_NET_SCH_TEQL is not set
@@ -426,12 +439,12 @@ CONFIG_NET_SCH_FIFO=y
 # CONFIG_IRDA is not set
 # CONFIG_BT is not set
 # CONFIG_AF_RXRPC is not set
-
-#
-# Wireless
-#
+# CONFIG_PHONET is not set
+CONFIG_WIRELESS=y
 # CONFIG_CFG80211 is not set
+CONFIG_WIRELESS_OLD_REGULATORY=y
 CONFIG_WIRELESS_EXT=y
+CONFIG_WIRELESS_EXT_SYSFS=y
 # CONFIG_MAC80211 is not set
 CONFIG_IEEE80211=y
 # CONFIG_IEEE80211_DEBUG is not set
@@ -452,6 +465,8 @@ CONFIG_UEVENT_HELPER_PATH="/sbin/hotplug"
 CONFIG_STANDALONE=y
 CONFIG_PREVENT_FIRMWARE_BUILD=y
 CONFIG_FW_LOADER=y
+CONFIG_FIRMWARE_IN_KERNEL=y
+CONFIG_EXTRA_FIRMWARE=""
 # CONFIG_SYS_HYPERVISOR is not set
 CONFIG_CONNECTOR=y
 CONFIG_PROC_EVENTS=y
@@ -538,23 +553,6 @@ CONFIG_MTD_NAND_MXC_V3=y
 # UBI - Unsorted block images
 #
 # CONFIG_MTD_UBI is not set
-
-#
-# Voltage and Current regulators
-#
-CONFIG_REGULATOR_API=y
-CONFIG_REGULATOR=y
-# CONFIG_REGULATOR_DEBUG is not set
-CONFIG_REGULATOR_MC13892=y
-CONFIG_REGULATOR_WM8350=y
-
-#
-# WM8350 Config Mode
-#
-CONFIG_PMIC_WM8350_MODE_0=y
-# CONFIG_PMIC_WM8350_MODE_1 is not set
-# CONFIG_PMIC_WM8350_MODE_2 is not set
-# CONFIG_PMIC_WM8350_MODE_3 is not set
 # CONFIG_PARPORT is not set
 CONFIG_BLK_DEV=y
 # CONFIG_BLK_DEV_COW_COMMON is not set
@@ -567,7 +565,9 @@ CONFIG_BLK_DEV_LOOP=y
 # CONFIG_ATA_OVER_ETH is not set
 CONFIG_MISC_DEVICES=y
 # CONFIG_EEPROM_93CX6 is not set
+# CONFIG_ICS932S401 is not set
 # CONFIG_ENCLOSURE_SERVICES is not set
+# CONFIG_C2PORT is not set
 CONFIG_HAVE_IDE=y
 # CONFIG_IDE is not set
 
@@ -612,6 +612,7 @@ CONFIG_SCSI_WAIT_SCAN=m
 CONFIG_SCSI_LOWLEVEL=y
 # CONFIG_ISCSI_TCP is not set
 # CONFIG_SCSI_DEBUG is not set
+# CONFIG_SCSI_DH is not set
 CONFIG_ATA=m
 # CONFIG_ATA_NONSTANDARD is not set
 # CONFIG_SATA_PMP is not set
@@ -621,7 +622,6 @@ CONFIG_ATA_SFF=y
 CONFIG_PATA_FSL=m
 # CONFIG_MD is not set
 CONFIG_NETDEVICES=y
-# CONFIG_NETDEVICES_MULTIQUEUE is not set
 # CONFIG_DUMMY is not set
 # CONFIG_BONDING is not set
 # CONFIG_MACVLAN is not set
@@ -641,6 +641,9 @@ CONFIG_SMSC911X=y
 # CONFIG_IBM_NEW_EMAC_RGMII is not set
 # CONFIG_IBM_NEW_EMAC_TAH is not set
 # CONFIG_IBM_NEW_EMAC_EMAC4 is not set
+# CONFIG_IBM_NEW_EMAC_NO_FLOW_CTRL is not set
+# CONFIG_IBM_NEW_EMAC_MAL_CLR_ICINTSTAT is not set
+# CONFIG_IBM_NEW_EMAC_MAL_COMMON_ERR is not set
 # CONFIG_B44 is not set
 # CONFIG_CS89x0 is not set
 # CONFIG_FEC is not set
@@ -665,6 +668,7 @@ CONFIG_USB_USBNET=m
 # CONFIG_USB_NET_AX8817X is not set
 CONFIG_USB_NET_CDCETHER=m
 # CONFIG_USB_NET_DM9601 is not set
+# CONFIG_USB_NET_SMSC95XX is not set
 # CONFIG_USB_NET_GL620A is not set
 # CONFIG_USB_NET_NET1080 is not set
 # CONFIG_USB_NET_PLUSB is not set
@@ -716,14 +720,14 @@ CONFIG_INPUT_TOUCHSCREEN=y
 # CONFIG_TOUCHSCREEN_GUNZE is not set
 # CONFIG_TOUCHSCREEN_ELO is not set
 # CONFIG_TOUCHSCREEN_MTOUCH is not set
+# CONFIG_TOUCHSCREEN_INEXIO is not set
 # CONFIG_TOUCHSCREEN_MK712 is not set
-CONFIG_TOUCHSCREEN_MXC=y
+CONFIG_TOUCHSCREEN_TSC2007=y
 # CONFIG_TOUCHSCREEN_PENMOUNT is not set
 # CONFIG_TOUCHSCREEN_TOUCHRIGHT is not set
 # CONFIG_TOUCHSCREEN_TOUCHWIN is not set
-# CONFIG_TOUCHSCREEN_UCB1400 is not set
 # CONFIG_TOUCHSCREEN_USB_COMPOSITE is not set
-CONFIG_TOUCHSCREEN_TSC2007=y
+# CONFIG_TOUCHSCREEN_TOUCHIT213 is not set
 # CONFIG_INPUT_MISC is not set
 
 #
@@ -736,6 +740,7 @@ CONFIG_TOUCHSCREEN_TSC2007=y
 # Character devices
 #
 CONFIG_VT=y
+CONFIG_CONSOLE_TRANSLATIONS=y
 CONFIG_VT_CONSOLE=y
 CONFIG_HW_CONSOLE=y
 # CONFIG_VT_HW_CONSOLE_BINDING is not set
@@ -754,6 +759,7 @@ CONFIG_MXC_IIM=m
 #
 CONFIG_SERIAL_MXC=y
 CONFIG_SERIAL_MXC_CONSOLE=y
+# CONFIG_SERIAL_IMX is not set
 CONFIG_SERIAL_CORE=y
 CONFIG_SERIAL_CORE_CONSOLE=y
 CONFIG_UNIX98_PTYS=y
@@ -761,6 +767,7 @@ CONFIG_LEGACY_PTYS=y
 CONFIG_LEGACY_PTY_COUNT=256
 # CONFIG_IPMI_HANDLER is not set
 CONFIG_HW_RANDOM=y
+# CONFIG_HW_RANDOM_FSL_RNGC is not set
 # CONFIG_NVRAM is not set
 # CONFIG_R3964 is not set
 # CONFIG_RAW_DRIVER is not set
@@ -768,27 +775,42 @@ CONFIG_HW_RANDOM=y
 CONFIG_I2C=y
 CONFIG_I2C_BOARDINFO=y
 CONFIG_I2C_CHARDEV=y
+CONFIG_I2C_HELPER_AUTO=y
 
 #
 # I2C Hardware Bus support
 #
+
+#
+# I2C system bus drivers (mostly embedded / system-on-chip)
+#
 CONFIG_I2C_MXC=y
 # CONFIG_I2C_MXC_HS is not set
 # CONFIG_I2C_OCORES is not set
-# CONFIG_I2C_PARPORT_LIGHT is not set
 # CONFIG_I2C_SIMTEC is not set
+
+#
+# External I2C/SMBus adapter drivers
+#
+# CONFIG_I2C_PARPORT_LIGHT is not set
 # CONFIG_I2C_TAOS_EVM is not set
-# CONFIG_I2C_STUB is not set
 # CONFIG_I2C_TINY_USB is not set
+
+#
+# Other I2C/SMBus bus drivers
+#
 # CONFIG_I2C_PCA_PLATFORM is not set
+# CONFIG_I2C_STUB is not set
 
 #
 # Miscellaneous I2C Chip support
 #
 # CONFIG_DS1682 is not set
+# CONFIG_AT24 is not set
 # CONFIG_SENSORS_EEPROM is not set
 # CONFIG_SENSORS_PCF8574 is not set
 # CONFIG_PCF8575 is not set
+# CONFIG_SENSORS_PCA9539 is not set
 # CONFIG_SENSORS_PCF8591 is not set
 # CONFIG_SENSORS_MAX6875 is not set
 # CONFIG_SENSORS_TSL2550 is not set
@@ -820,13 +842,16 @@ CONFIG_SPI_MXC_SELECT2=y
 # CONFIG_POWER_SUPPLY is not set
 CONFIG_HWMON=y
 # CONFIG_HWMON_VID is not set
+# CONFIG_SENSORS_AD7414 is not set
 # CONFIG_SENSORS_AD7418 is not set
+# CONFIG_SENSORS_ADCXX is not set
 # CONFIG_SENSORS_ADM1021 is not set
 # CONFIG_SENSORS_ADM1025 is not set
 # CONFIG_SENSORS_ADM1026 is not set
 # CONFIG_SENSORS_ADM1029 is not set
 # CONFIG_SENSORS_ADM1031 is not set
 # CONFIG_SENSORS_ADM9240 is not set
+# CONFIG_SENSORS_ADT7462 is not set
 # CONFIG_SENSORS_ADT7470 is not set
 # CONFIG_SENSORS_ADT7473 is not set
 # CONFIG_SENSORS_ATXP1 is not set
@@ -849,6 +874,7 @@ CONFIG_HWMON=y
 # CONFIG_SENSORS_LM90 is not set
 # CONFIG_SENSORS_LM92 is not set
 # CONFIG_SENSORS_LM93 is not set
+# CONFIG_SENSORS_MAX1111 is not set
 # CONFIG_SENSORS_MAX1619 is not set
 # CONFIG_SENSORS_MAX6650 is not set
 # CONFIG_SENSORS_PC87360 is not set
@@ -870,6 +896,8 @@ CONFIG_HWMON=y
 # CONFIG_SENSORS_W83627EHF is not set
 # CONFIG_HWMON_DEBUG_CHIP is not set
 CONFIG_SENSORS_ISL29003=y
+# CONFIG_THERMAL is not set
+# CONFIG_THERMAL_HWMON is not set
 CONFIG_WATCHDOG=y
 CONFIG_WATCHDOG_NOWAYOUT=y
 
@@ -883,19 +911,25 @@ CONFIG_MXC_WATCHDOG=y
 # USB-based Watchdog Cards
 #
 # CONFIG_USBPCWATCHDOG is not set
+CONFIG_SSB_POSSIBLE=y
 
 #
 # Sonics Silicon Backplane
 #
-CONFIG_SSB_POSSIBLE=y
 # CONFIG_SSB is not set
 
 #
 # Multifunction device drivers
 #
+# CONFIG_MFD_CORE is not set
 # CONFIG_MFD_SM501 is not set
-# CONFIG_MFD_ASIC3 is not set
 # CONFIG_HTC_PASIC3 is not set
+# CONFIG_MFD_TMIO is not set
+# CONFIG_PMIC_DA903X is not set
+# CONFIG_MFD_WM8400 is not set
+CONFIG_MFD_WM8350=y
+CONFIG_MFD_WM8350_CONFIG_MODE_0=y
+CONFIG_MFD_WM8350_I2C=y
 
 #
 # Multimedia devices
@@ -929,6 +963,7 @@ CONFIG_VIDEO_V4L2=y
 CONFIG_VIDEO_V4L1=y
 CONFIG_VIDEO_CAPTURE_DRIVERS=y
 # CONFIG_VIDEO_ADV_DEBUG is not set
+# CONFIG_VIDEO_FIXED_MINOR_RANGES is not set
 # CONFIG_VIDEO_HELPER_CHIPS_AUTO is not set
 
 #
@@ -1004,9 +1039,32 @@ CONFIG_VIDEO_MXC_IPU_OUTPUT=y
 # CONFIG_VIDEO_CPIA2 is not set
 # CONFIG_VIDEO_SAA5246A is not set
 # CONFIG_VIDEO_SAA5249 is not set
-# CONFIG_TUNER_3036 is not set
+# CONFIG_SOC_CAMERA is not set
 CONFIG_V4L_USB_DRIVERS=y
 # CONFIG_USB_VIDEO_CLASS is not set
+CONFIG_USB_GSPCA=m
+# CONFIG_USB_M5602 is not set
+# CONFIG_USB_GSPCA_CONEX is not set
+# CONFIG_USB_GSPCA_ETOMS is not set
+# CONFIG_USB_GSPCA_FINEPIX is not set
+# CONFIG_USB_GSPCA_MARS is not set
+# CONFIG_USB_GSPCA_OV519 is not set
+# CONFIG_USB_GSPCA_PAC207 is not set
+# CONFIG_USB_GSPCA_PAC7311 is not set
+# CONFIG_USB_GSPCA_SONIXB is not set
+# CONFIG_USB_GSPCA_SONIXJ is not set
+# CONFIG_USB_GSPCA_SPCA500 is not set
+# CONFIG_USB_GSPCA_SPCA501 is not set
+# CONFIG_USB_GSPCA_SPCA505 is not set
+# CONFIG_USB_GSPCA_SPCA506 is not set
+# CONFIG_USB_GSPCA_SPCA508 is not set
+# CONFIG_USB_GSPCA_SPCA561 is not set
+# CONFIG_USB_GSPCA_STK014 is not set
+# CONFIG_USB_GSPCA_SUNPLUS is not set
+# CONFIG_USB_GSPCA_T613 is not set
+# CONFIG_USB_GSPCA_TV8532 is not set
+# CONFIG_USB_GSPCA_VC032X is not set
+# CONFIG_USB_GSPCA_ZC3XX is not set
 # CONFIG_VIDEO_PVRUSB2 is not set
 # CONFIG_VIDEO_EM28XX is not set
 # CONFIG_VIDEO_USBVISION is not set
@@ -1016,7 +1074,6 @@ CONFIG_V4L_USB_DRIVERS=y
 # CONFIG_USB_QUICKCAM_MESSENGER is not set
 # CONFIG_USB_ET61X251 is not set
 # CONFIG_VIDEO_OVCAMCHIP is not set
-# CONFIG_USB_W9968CF is not set
 # CONFIG_USB_OV511 is not set
 # CONFIG_USB_SE401 is not set
 # CONFIG_USB_SN9C102 is not set
@@ -1025,7 +1082,7 @@ CONFIG_V4L_USB_DRIVERS=y
 # CONFIG_USB_PWC is not set
 # CONFIG_USB_ZR364XX is not set
 # CONFIG_USB_STKWEBCAM is not set
-# CONFIG_SOC_CAMERA is not set
+# CONFIG_USB_S2255 is not set
 # CONFIG_RADIO_ADAPTERS is not set
 # CONFIG_DAB is not set
 
@@ -1037,6 +1094,7 @@ CONFIG_V4L_USB_DRIVERS=y
 CONFIG_FB=y
 # CONFIG_FIRMWARE_EDID is not set
 # CONFIG_FB_DDC is not set
+# CONFIG_FB_BOOT_VESA_SUPPORT is not set
 CONFIG_FB_CFB_FILLRECT=y
 CONFIG_FB_CFB_COPYAREA=y
 CONFIG_FB_CFB_IMAGEBLIT=y
@@ -1060,18 +1118,20 @@ CONFIG_FB_MXC_SYNC_PANEL=y
 CONFIG_FB_MXC_EPSON_VGA_SYNC_PANEL=y
 CONFIG_FB_MXC_TVOUT_TVE=y
 # CONFIG_FB_MXC_CLAA_WVGA_SYNC_PANEL is not set
+# CONFIG_FB_MXC_CH7026 is not set
 # CONFIG_FB_MXC_TVOUT is not set
 # CONFIG_FB_MXC_TVOUT_CH7024 is not set
 # CONFIG_FB_MXC_ASYNC_PANEL is not set
 # CONFIG_FB_UVESA is not set
 # CONFIG_FB_S1D13XXX is not set
 # CONFIG_FB_VIRTUAL is not set
+# CONFIG_FB_METRONOME is not set
+# CONFIG_FB_MB862XX is not set
 CONFIG_BACKLIGHT_LCD_SUPPORT=y
 # CONFIG_LCD_CLASS_DEVICE is not set
 CONFIG_BACKLIGHT_CLASS_DEVICE=y
 # CONFIG_BACKLIGHT_CORGI is not set
 CONFIG_BACKLIGHT_MXC=y
-CONFIG_BACKLIGHT_MXC_MC13892=y
 CONFIG_BACKLIGHT_WM8350=y
 
 #
@@ -1102,15 +1162,8 @@ CONFIG_LOGO=y
 # CONFIG_LOGO_LINUX_MONO is not set
 # CONFIG_LOGO_LINUX_VGA16 is not set
 CONFIG_LOGO_LINUX_CLUT224=y
-
-#
-# Sound
-#
 CONFIG_SOUND=y
-
-#
-# Advanced Linux Sound Architecture
-#
+CONFIG_SOUND_OSS_CORE=y
 CONFIG_SND=y
 CONFIG_SND_TIMER=y
 CONFIG_SND_PCM=y
@@ -1124,56 +1177,24 @@ CONFIG_SND_SUPPORT_OLD_API=y
 CONFIG_SND_VERBOSE_PROCFS=y
 # CONFIG_SND_VERBOSE_PRINTK is not set
 # CONFIG_SND_DEBUG is not set
-
-#
-# Generic devices
-#
+CONFIG_SND_DRIVERS=y
 # CONFIG_SND_DUMMY is not set
 # CONFIG_SND_MTPAV is not set
 # CONFIG_SND_SERIAL_U16550 is not set
 # CONFIG_SND_MPU401 is not set
-
-#
-# ALSA ARM devices
-#
+CONFIG_SND_ARM=y
 CONFIG_SND_MXC_SPDIF=m
-
-#
-# SPI devices
-#
-
-#
-# USB devices
-#
+CONFIG_SND_SPI=y
+CONFIG_SND_USB=y
 # CONFIG_SND_USB_AUDIO is not set
 # CONFIG_SND_USB_CAIAQ is not set
-
-#
-# System on Chip audio support
-#
 CONFIG_SND_SOC=y
 CONFIG_SND_MXC_SOC=y
 CONFIG_SND_MXC_SOC_SSI=y
 # CONFIG_SND_MXC_SOC_IRAM is not set
-CONFIG_SND_SOC_IMX_3STACK_WM8350=y
-# CONFIG_SND_SOC_IMX_3STACK_AK4647 is not set
-# CONFIG_SND_SOC_IMX_3STACK_WM8580 is not set
-# CONFIG_SND_SOC_IMX_3STACK_WM8903 is not set
 CONFIG_SND_SOC_IMX_3STACK_SGTL5000=y
-
-#
-# ALSA SoC audio for Freescale SOCs
-#
-
-#
-# SoC Audio for the Texas Instruments OMAP
-#
-CONFIG_SND_SOC_WM8350=y
+# CONFIG_SND_SOC_ALL_CODECS is not set
 CONFIG_SND_SOC_SGTL5000=y
-
-#
-# Open Sound System
-#
 # CONFIG_SOUND_PRIME is not set
 CONFIG_HID_SUPPORT=y
 CONFIG_HID=y
@@ -1184,8 +1205,7 @@ CONFIG_HID=y
 # USB Input Devices
 #
 CONFIG_USB_HID=m
-# CONFIG_USB_HIDINPUT_POWERBOOK is not set
-# CONFIG_HID_FF is not set
+# CONFIG_HID_PID is not set
 # CONFIG_USB_HIDDEV is not set
 
 #
@@ -1193,6 +1213,34 @@ CONFIG_USB_HID=m
 #
 # CONFIG_USB_KBD is not set
 # CONFIG_USB_MOUSE is not set
+
+#
+# Special HID drivers
+#
+CONFIG_HID_COMPAT=y
+CONFIG_HID_A4TECH=m
+CONFIG_HID_APPLE=m
+CONFIG_HID_BELKIN=m
+CONFIG_HID_BRIGHT=m
+CONFIG_HID_CHERRY=m
+CONFIG_HID_CHICONY=m
+CONFIG_HID_CYPRESS=m
+CONFIG_HID_DELL=m
+CONFIG_HID_EZKEY=m
+CONFIG_HID_GYRATION=m
+CONFIG_HID_LOGITECH=m
+# CONFIG_LOGITECH_FF is not set
+# CONFIG_LOGIRUMBLEPAD2_FF is not set
+CONFIG_HID_MICROSOFT=m
+CONFIG_HID_MONTEREY=m
+CONFIG_HID_PANTHERLORD=m
+# CONFIG_PANTHERLORD_FF is not set
+CONFIG_HID_PETALYNX=m
+CONFIG_HID_SAMSUNG=m
+CONFIG_HID_SONY=m
+CONFIG_HID_SUNPLUS=m
+# CONFIG_THRUSTMASTER_FF is not set
+# CONFIG_ZEROPLUS_FF is not set
 CONFIG_USB_SUPPORT=y
 CONFIG_USB_ARCH_HAS_HCD=y
 # CONFIG_USB_ARCH_HAS_OHCI is not set
@@ -1211,6 +1259,9 @@ CONFIG_USB_DEVICEFS=y
 # CONFIG_USB_OTG is not set
 # CONFIG_USB_OTG_WHITELIST is not set
 # CONFIG_USB_OTG_BLACKLIST_HUB is not set
+# CONFIG_USB_MON is not set
+# CONFIG_USB_WUSB is not set
+# CONFIG_USB_WUSB_CBAF is not set
 
 #
 # USB Host Controller Drivers
@@ -1219,6 +1270,7 @@ CONFIG_USB_DEVICEFS=y
 CONFIG_USB_EHCI_HCD=m
 CONFIG_USB_EHCI_ARC=y
 CONFIG_USB_EHCI_ARC_OTG=y
+# CONFIG_USB_EHCI_ARC_OTG_WAKE_UP is not set
 # CONFIG_USB_STATIC_IRAM is not set
 # CONFIG_USB_EHCI_FSL_MC13783 is not set
 # CONFIG_USB_EHCI_FSL_1301 is not set
@@ -1227,9 +1279,10 @@ CONFIG_USB_EHCI_FSL_UTMI=y
 CONFIG_USB_EHCI_ROOT_HUB_TT=y
 # CONFIG_USB_EHCI_TT_NEWSCHED is not set
 # CONFIG_USB_ISP116X_HCD is not set
-# CONFIG_USB_ISP1760_HCD is not set
 # CONFIG_USB_SL811_HCD is not set
 # CONFIG_USB_R8A66597_HCD is not set
+# CONFIG_USB_HWA_HCD is not set
+# CONFIG_USB_GADGET_MUSB_HDRC is not set
 
 #
 # USB Device Class drivers
@@ -1237,13 +1290,14 @@ CONFIG_USB_EHCI_ROOT_HUB_TT=y
 # CONFIG_USB_ACM is not set
 # CONFIG_USB_PRINTER is not set
 # CONFIG_USB_WDM is not set
+# CONFIG_USB_TMC is not set
 
 #
-# NOTE: USB_STORAGE enables SCSI, and 'SCSI disk support'
+# NOTE: USB_STORAGE depends on SCSI but BLK_DEV_SD may also be needed;
 #
 
 #
-# may also be needed; see USB_STORAGE Help for more information
+# see USB_STORAGE Help for more information
 #
 CONFIG_USB_STORAGE=y
 # CONFIG_USB_STORAGE_DEBUG is not set
@@ -1266,12 +1320,6 @@ CONFIG_USB_STORAGE=y
 #
 # CONFIG_USB_MDC800 is not set
 # CONFIG_USB_MICROTEK is not set
-# CONFIG_USB_MON is not set
-
-#
-# Belcarra USBLAN Networking for USB
-#
-# CONFIG_USB_USBLAN is not set
 
 #
 # USB port drivers
@@ -1284,7 +1332,7 @@ CONFIG_USB_STORAGE=y
 # CONFIG_USB_EMI62 is not set
 # CONFIG_USB_EMI26 is not set
 # CONFIG_USB_ADUTUX is not set
-# CONFIG_USB_AUERSWALD is not set
+# CONFIG_USB_SEVSEG is not set
 # CONFIG_USB_RIO500 is not set
 # CONFIG_USB_LEGOTOWER is not set
 # CONFIG_USB_LCD is not set
@@ -1302,27 +1350,31 @@ CONFIG_USB_STORAGE=y
 # CONFIG_USB_IOWARRIOR is not set
 # CONFIG_USB_TEST is not set
 # CONFIG_USB_ISIGHTFW is not set
+# CONFIG_USB_VST is not set
 CONFIG_USB_GADGET=m
 # CONFIG_USB_GADGET_DEBUG_FILES is not set
+CONFIG_USB_GADGET_VBUS_DRAW=2
 CONFIG_USB_GADGET_SELECTED=y
-# CONFIG_USB_GADGET_AMD5536UDC is not set
+# CONFIG_USB_GADGET_AT91 is not set
 # CONFIG_USB_GADGET_ATMEL_USBA is not set
 # CONFIG_USB_GADGET_FSL_USB2 is not set
-# CONFIG_USB_GADGET_NET2280 is not set
-# CONFIG_USB_GADGET_PXA2XX is not set
-# CONFIG_USB_GADGET_M66592 is not set
-# CONFIG_USB_GADGET_PXA27X is not set
-# CONFIG_USB_GADGET_GOKU is not set
 # CONFIG_USB_GADGET_LH7A40X is not set
 # CONFIG_USB_GADGET_OMAP is not set
+# CONFIG_USB_GADGET_PXA25X is not set
+# CONFIG_USB_GADGET_PXA27X is not set
+# CONFIG_USB_GADGET_S3C2410 is not set
+# CONFIG_USB_GADGET_M66592 is not set
+# CONFIG_USB_GADGET_AMD5536UDC is not set
+# CONFIG_USB_GADGET_FSL_QE is not set
+# CONFIG_USB_GADGET_NET2280 is not set
+# CONFIG_USB_GADGET_GOKU is not set
 CONFIG_USB_GADGET_ARC=y
 CONFIG_USB_STATIC_IRAM_PPH=y
 CONFIG_USB_ARC=m
-# CONFIG_USB_GADGET_S3C2410 is not set
-# CONFIG_USB_GADGET_AT91 is not set
 # CONFIG_USB_GADGET_DUMMY_HCD is not set
 CONFIG_USB_GADGET_DUALSPEED=y
 CONFIG_USB_GADGET_ARC_OTG=y
+# CONFIG_USB_GADGET_WAKE_UP is not set
 # CONFIG_USB_GADGET_FSL_MC13783 is not set
 # CONFIG_USB_GADGET_FSL_1301 is not set
 # CONFIG_USB_GADGET_FSL_1504 is not set
@@ -1335,12 +1387,13 @@ CONFIG_USB_FILE_STORAGE=m
 # CONFIG_USB_G_SERIAL is not set
 # CONFIG_USB_MIDI_GADGET is not set
 # CONFIG_USB_G_PRINTER is not set
+# CONFIG_USB_CDC_COMPOSITE is not set
 CONFIG_MMC=y
 # CONFIG_MMC_DEBUG is not set
 # CONFIG_MMC_UNSAFE_RESUME is not set
 
 #
-# MMC/SD Card Drivers
+# MMC/SD/SDIO Card Drivers
 #
 CONFIG_MMC_BLOCK=y
 CONFIG_MMC_BLOCK_BOUNCE=y
@@ -1349,12 +1402,15 @@ CONFIG_MMC_BLOCK_BOUNCE=y
 CONFIG_SDIO_UNIFI_FS=m
 
 #
-# MMC/SD Host Controller Drivers
+# MMC/SD/SDIO Host Controller Drivers
 #
+# CONFIG_MMC_SDHCI is not set
 # CONFIG_MMC_SPI is not set
 # CONFIG_MMC_MXC is not set
 CONFIG_MMC_IMX_ESDHCI=m
 # CONFIG_MMC_IMX_ESDHCI_PIO_MODE is not set
+# CONFIG_MEMSTICK is not set
+# CONFIG_ACCESSIBILITY is not set
 # CONFIG_NEW_LEDS is not set
 CONFIG_RTC_LIB=y
 CONFIG_RTC_CLASS=y
@@ -1386,31 +1442,47 @@ CONFIG_RTC_INTF_DEV_UIE_EMUL=y
 # CONFIG_RTC_DRV_M41T80 is not set
 # CONFIG_RTC_DRV_S35390A is not set
 # CONFIG_RTC_DRV_FM3130 is not set
+# CONFIG_RTC_DRV_RX8581 is not set
 
 #
 # SPI RTC drivers
 #
+# CONFIG_RTC_DRV_M41T94 is not set
+# CONFIG_RTC_DRV_DS1305 is not set
+# CONFIG_RTC_DRV_DS1390 is not set
 # CONFIG_RTC_DRV_MAX6902 is not set
 # CONFIG_RTC_DRV_R9701 is not set
 # CONFIG_RTC_DRV_RS5C348 is not set
+# CONFIG_RTC_DRV_DS3234 is not set
 
 #
 # Platform RTC drivers
 #
 # CONFIG_RTC_DRV_CMOS is not set
+# CONFIG_RTC_DRV_DS1286 is not set
 # CONFIG_RTC_DRV_DS1511 is not set
 # CONFIG_RTC_DRV_DS1553 is not set
 # CONFIG_RTC_DRV_DS1742 is not set
 # CONFIG_RTC_DRV_STK17TA8 is not set
 # CONFIG_RTC_DRV_M48T86 is not set
+# CONFIG_RTC_DRV_M48T35 is not set
 # CONFIG_RTC_DRV_M48T59 is not set
+# CONFIG_RTC_DRV_BQ4802 is not set
 # CONFIG_RTC_DRV_V3020 is not set
+# CONFIG_RTC_DRV_WM8350 is not set
 
 #
 # on-CPU RTC drivers
 #
 # CONFIG_RTC_MXC is not set
 CONFIG_RTC_DRV_MXC_V2=y
+# CONFIG_DMADEVICES is not set
+CONFIG_REGULATOR=y
+# CONFIG_REGULATOR_DEBUG is not set
+# CONFIG_REGULATOR_FIXED_VOLTAGE is not set
+# CONFIG_REGULATOR_VIRTUAL_CONSUMER is not set
+# CONFIG_REGULATOR_BQ24022 is not set
+CONFIG_REGULATOR_WM8350=y
 # CONFIG_UIO is not set
 
 #
@@ -1418,6 +1490,7 @@ CONFIG_RTC_DRV_MXC_V2=y
 #
 CONFIG_MXC_IPU=y
 CONFIG_MXC_IPU_V3=y
+CONFIG_MXC_IPU_V3D=y
 
 #
 # MXC SSI support
@@ -1432,25 +1505,10 @@ CONFIG_MXC_IPU_V3=y
 #
 # MXC PMIC support
 #
-CONFIG_MXC_PMIC=y
 # CONFIG_MXC_PMIC_MC13783 is not set
-CONFIG_MXC_PMIC_MC13892=y
-CONFIG_MXC_PMIC_I2C=y
-# CONFIG_MXC_PMIC_CHARDEV is not set
-
-#
-# MXC PMIC Client Drivers
-#
-CONFIG_MXC_MC13892_ADC=y
-CONFIG_MXC_MC13892_RTC=y
-CONFIG_MXC_MC13892_LIGHT=y
-CONFIG_MXC_MC13892_BATTERY=y
-# CONFIG_MXC_MC13892_CONNECTIVITY is not set
-CONFIG_MXC_MC13892_POWER=y
-
-#
-# Advanced Power Management devices
-#
+# CONFIG_MXC_PMIC_MC13892 is not set
+# CONFIG_MXC_PMIC_MC34704 is not set
+# CONFIG_MXC_PMIC_MC9SDZ60 is not set
 
 #
 # MXC Security Drivers
@@ -1493,22 +1551,29 @@ CONFIG_MXC_BLUETOOTH=m
 #
 # Broadcom GPS ioctrl support
 #
+CONFIG_GPS_IOCTRL=m
 
 #
 # MXC Media Local Bus Driver
 #
 
 #
+# i.MX ADC support
+#
+# CONFIG_IMX_ADC is not set
+
+#
 # File systems
 #
 CONFIG_EXT2_FS=y
 # CONFIG_EXT2_FS_XATTR is not set
 # CONFIG_EXT2_FS_XIP is not set
 # CONFIG_EXT3_FS is not set
-# CONFIG_EXT4DEV_FS is not set
+# CONFIG_EXT4_FS is not set
 # CONFIG_REISERFS_FS is not set
 # CONFIG_JFS_FS is not set
 # CONFIG_FS_POSIX_ACL is not set
+CONFIG_FILE_LOCKING=y
 # CONFIG_XFS_FS is not set
 # CONFIG_OCFS2_FS is not set
 CONFIG_DNOTIFY=y
@@ -1540,6 +1605,7 @@ CONFIG_FAT_DEFAULT_IOCHARSET="iso8859-1"
 #
 CONFIG_PROC_FS=y
 CONFIG_PROC_SYSCTL=y
+CONFIG_PROC_PAGE_MONITOR=y
 CONFIG_SYSFS=y
 CONFIG_TMPFS=y
 # CONFIG_TMPFS_POSIX_ACL is not set
@@ -1570,6 +1636,7 @@ CONFIG_JFFS2_RTIME=y
 CONFIG_CRAMFS=y
 # CONFIG_VXFS_FS is not set
 # CONFIG_MINIX_FS is not set
+# CONFIG_OMFS_FS is not set
 # CONFIG_HPFS_FS is not set
 # CONFIG_QNX4FS_FS is not set
 # CONFIG_ROMFS_FS is not set
@@ -1580,13 +1647,13 @@ CONFIG_NFS_FS=y
 CONFIG_NFS_V3=y
 # CONFIG_NFS_V3_ACL is not set
 # CONFIG_NFS_V4 is not set
-# CONFIG_NFSD is not set
 CONFIG_ROOT_NFS=y
+# CONFIG_NFSD is not set
 CONFIG_LOCKD=y
 CONFIG_LOCKD_V4=y
 CONFIG_NFS_COMMON=y
 CONFIG_SUNRPC=y
-# CONFIG_SUNRPC_BIND34 is not set
+# CONFIG_SUNRPC_REGISTER_V4 is not set
 # CONFIG_RPCSEC_GSS_KRB5 is not set
 # CONFIG_RPCSEC_GSS_SPKM3 is not set
 # CONFIG_SMB_FS is not set
@@ -1657,8 +1724,19 @@ CONFIG_FRAME_WARN=1024
 # CONFIG_SLUB_DEBUG_ON is not set
 # CONFIG_SLUB_STATS is not set
 # CONFIG_DEBUG_BUGVERBOSE is not set
+# CONFIG_DEBUG_MEMORY_INIT is not set
 CONFIG_FRAME_POINTER=y
+# CONFIG_RCU_CPU_STALL_DETECTOR is not set
+# CONFIG_LATENCYTOP is not set
+CONFIG_SYSCTL_SYSCALL_CHECK=y
+CONFIG_HAVE_FUNCTION_TRACER=y
+
+#
+# Tracers
+#
+# CONFIG_DYNAMIC_PRINTK_DEBUG is not set
 # CONFIG_SAMPLES is not set
+CONFIG_HAVE_ARCH_KGDB=y
 # CONFIG_DEBUG_USER is not set
 
 #
@@ -1666,13 +1744,16 @@ CONFIG_FRAME_POINTER=y
 #
 # CONFIG_KEYS is not set
 # CONFIG_SECURITY is not set
+# CONFIG_SECURITYFS is not set
 # CONFIG_SECURITY_FILE_CAPABILITIES is not set
 CONFIG_CRYPTO=y
 
 #
 # Crypto core or helper
 #
+# CONFIG_CRYPTO_FIPS is not set
 # CONFIG_CRYPTO_MANAGER is not set
+# CONFIG_CRYPTO_MANAGER2 is not set
 # CONFIG_CRYPTO_GF128MUL is not set
 # CONFIG_CRYPTO_NULL is not set
 # CONFIG_CRYPTO_CRYPTD is not set
@@ -1710,6 +1791,10 @@ CONFIG_CRYPTO=y
 # CONFIG_CRYPTO_MD4 is not set
 # CONFIG_CRYPTO_MD5 is not set
 # CONFIG_CRYPTO_MICHAEL_MIC is not set
+# CONFIG_CRYPTO_RMD128 is not set
+# CONFIG_CRYPTO_RMD160 is not set
+# CONFIG_CRYPTO_RMD256 is not set
+# CONFIG_CRYPTO_RMD320 is not set
 # CONFIG_CRYPTO_SHA1 is not set
 # CONFIG_CRYPTO_SHA256 is not set
 # CONFIG_CRYPTO_SHA512 is not set
@@ -1740,16 +1825,20 @@ CONFIG_CRYPTO=y
 #
 # CONFIG_CRYPTO_DEFLATE is not set
 # CONFIG_CRYPTO_LZO is not set
+
+#
+# Random Number Generation
+#
+# CONFIG_CRYPTO_ANSI_CPRNG is not set
 CONFIG_CRYPTO_HW=y
 
 #
 # Library routines
 #
 CONFIG_BITREVERSE=y
-# CONFIG_GENERIC_FIND_FIRST_BIT is not set
-# CONFIG_GENERIC_FIND_NEXT_BIT is not set
 CONFIG_CRC_CCITT=m
 # CONFIG_CRC16 is not set
+# CONFIG_CRC_T10DIF is not set
 # CONFIG_CRC_ITU_T is not set
 CONFIG_CRC32=y
 # CONFIG_CRC7 is not set
diff --git a/arch/arm/mach-mx37/Kconfig b/arch/arm/mach-mx37/Kconfig
index c62128f..6e4976e 100644
--- a/arch/arm/mach-mx37/Kconfig
+++ b/arch/arm/mach-mx37/Kconfig
@@ -16,6 +16,7 @@ config MX37_OPTIONS
 config MACH_MX37_3DS
 	bool "Support MX37 3-Stack platforms"
 	default y
+	select MFD_WM8350_CONFIG_MODE_0
 	help
 	  Include support for MX37 3-Stack platform. This includes specific
 	  configurations for the board and its peripherals.
diff --git a/arch/arm/mach-mx37/mx37_3stack.c b/arch/arm/mach-mx37/mx37_3stack.c
index 0c374b7..8028e60 100644
--- a/arch/arm/mach-mx37/mx37_3stack.c
+++ b/arch/arm/mach-mx37/mx37_3stack.c
@@ -101,6 +101,8 @@ struct cpu_wp *get_cpu_wp(int *wp)
 	return cpu_wp_auto;
 }
 
+#if defined(CONFIG_REGULATOR_MC13892) \
+    || defined(CONFIG_REGULATOR_MC13892_MODULE)
 static int mc13892_reg_int(void)
 {
 	int i = 0;
@@ -176,6 +178,7 @@ static int mc13892_reg_int(void)
 }
 
 late_initcall(mc13892_reg_int);
+#endif
 
 static void mxc_nop_release(struct device *dev)
 {
diff --git a/arch/arm/mach-mx37/mx37_3stack_pmic_wm8350.c b/arch/arm/mach-mx37/mx37_3stack_pmic_wm8350.c
index ac304f9..9a6c793 100644
--- a/arch/arm/mach-mx37/mx37_3stack_pmic_wm8350.c
+++ b/arch/arm/mach-mx37/mx37_3stack_pmic_wm8350.c
@@ -15,248 +15,160 @@
  */
 
 #include <linux/module.h>
-#include <linux/moduleparam.h>
 #include <linux/init.h>
-#include <linux/delay.h>
-#include <linux/pm.h>
-#include <linux/bitops.h>
 #include <linux/platform_device.h>
 #include <linux/i2c.h>
 #include <linux/err.h>
-#include <linux/regulator/consumer.h>
 #include <linux/regulator/machine.h>
-#include <linux/regulator/wm8350/wm8350.h>
-#include <linux/regulator/wm8350/wm8350-pmic.h>
-#include <linux/regulator/wm8350/wm8350-gpio.h>
-#include <linux/regulator/wm8350/wm8350-bus.h>
-#include <linux/interrupt.h>
-#include <linux/irq.h>
-#include <linux/leds.h>
-#include <linux/fb.h>
-
-#include <mach/dma.h>
-#include <mach/spba.h>
-#include <mach/clock.h>
-#include <mach/mxc.h>
-#include "board-mx37_3stack.h"
-
-static void wm8350_regulator_init(void)
-{
-	int i = 0;
-	struct regulator *regulator;
-	char *wm8350_global_regulator[] = {
-		"DCDC1",
-		"DCDC3",
-		"DCDC4",
-		"DCDC6",
-		"LDO3",
-	};
-
-	/* for board v2.0 later, do nothing here*/
-	if (board_is_mx37(BOARD_REV_2))
-		return;
-	while ((i < ARRAY_SIZE(wm8350_global_regulator)) &&
-		!IS_ERR_VALUE((unsigned long)(regulator = regulator_get(NULL,
-		wm8350_global_regulator[i])))) {
-		regulator_enable(regulator);
-		i++;
-	}
-}
-late_initcall(wm8350_regulator_init);
-
-/*
- * Set to 1 when testing battery that is connected otherwise spuriuos debug
- */
-#define BATTERY 0
+#include <linux/mfd/wm8350/core.h>
+#include <linux/mfd/wm8350/pmic.h>
+#include <linux/mfd/wm8350/gpio.h>
+#include <linux/mfd/wm8350/bl.h>
 
-/* extern const char imx_3stack_audio[32]; */
-
-struct mxc_audio_platform_data imx_3stack_audio_platform_data = {
-	.ssi_num = 2,
-	.src_port = 2,
-	.ext_port = 5,
-	.regulator1 = "DCDC6",
-	.regulator2 = "DCDC3"
+/* CPU */
+static struct regulator_consumer_supply dcdc1_consumers[] = {
+	{
+	 .supply = "cpu_vcc",
+	 }
 };
 
-#ifdef NOT_PORTED_TO_IMX37_3STACK_YET
-
-static void imx37_3stack_switch_handler(struct wm8350 *wm8350, int irq)
-{
-	printk("switch pressed %d\n", irq);
-}
-#endif
-static struct platform_device *imx_snd_device;
+static struct regulator_init_data dcdc1_data = {
+	.constraints = {
+			.name = "DCDC1",
+			.min_uV = 850000,
+			.max_uV = 1200000,
+			.valid_ops_mask = REGULATOR_CHANGE_VOLTAGE |
+			REGULATOR_CHANGE_MODE,
+			.valid_modes_mask = REGULATOR_MODE_NORMAL |
+			REGULATOR_MODE_FAST,
+			.state_mem = {
+				      .uV = 1000000,
+				      .mode = REGULATOR_MODE_NORMAL,
+				      .enabled = 1,
+				      },
+			.initial_state = PM_SUSPEND_MEM,
+			.always_on = 1,
+			.boot_on = 1,
+			},
+	.num_consumer_supplies = ARRAY_SIZE(dcdc1_consumers),
+	.consumer_supplies = dcdc1_consumers,
+};
 
-void wm8350_free(struct wm8350 *wm8350)
-{
-#if BATTERY
-	struct wm8350_power *power = &wm8350->power;
-#endif
-
-	wm8350_mask_irq(wm8350, WM8350_IRQ_GPIO(7));
-	wm8350_free_irq(wm8350, WM8350_IRQ_GPIO(7));
-	wm8350_mask_irq(wm8350, WM8350_IRQ_WKUP_ONKEY);
-	wm8350_free_irq(wm8350, WM8350_IRQ_WKUP_ONKEY);
-
-#if BATTERY
-	wm8350_charger_enable(power, 0);
-	wm8350_fast_charger_enable(power, 0);
-#endif
-	if (wm8350->nirq)
-		free_irq(wm8350->nirq, wm8350);
-
-	flush_scheduled_work();
-
-	if (device_is_registered(&wm8350->pmic.dev))
-		device_unregister(&wm8350->pmic.dev);
-	if (device_is_registered(&wm8350->rtc.dev))
-		device_unregister(&wm8350->rtc.dev);
-	if (device_is_registered(&wm8350->wdg.dev))
-		device_unregister(&wm8350->wdg.dev);
-	if (device_is_registered(&wm8350->power.dev))
-		device_unregister(&wm8350->power.dev);
-
-	platform_device_unregister(imx_snd_device);
-}
+/* MX37 LP */
+static struct regulator_init_data dcdc4_data = {
+	.constraints = {
+			.name = "DCDC4",
+			.min_uV = 1000000,
+			.max_uV = 1200000,
+			.state_mem = {
+				      .uV = 1000000,
+				      .mode = REGULATOR_MODE_NORMAL,
+				      .enabled = 1,
+				      },
+			.initial_state = PM_SUSPEND_MEM,
+			.always_on = 1,
+			.boot_on = 1,
+			},
+};
 
-#if BATTERY
-static int wm8350_init_battery(struct wm8350 *wm8350)
-{
-	struct wm8350_power *power = &wm8350->power;
-	struct wm8350_charger_policy *policy = &power->policy;
-
-	policy->eoc_mA = WM8350_CHG_EOC_mA(10);
-	policy->charge_mV = WM8350_CHG_4_05V;
-	policy->fast_limit_mA = WM8350_CHG_FAST_LIMIT_mA(400);
-	policy->charge_timeout = WM8350_CHG_TIME_MIN(60);
-	policy->trickle_start_mV = WM8350_CHG_TRICKLE_3_1V;
-	policy->trickle_charge_mA = WM8350_CHG_TRICKLE_50mA;
-
-	wm8350_charger_enable(power, 1);
-	wm8350_fast_charger_enable(power, 1);
-	return 0;
-}
-#endif
+/* DDR RAM */
+static struct regulator_init_data dcdc6_data = {
+	.constraints = {
+			.name = "DCDC6",
+			.min_uV = 1800000,
+			.max_uV = 1800000,
+			.valid_modes_mask = REGULATOR_MODE_NORMAL,
+			.state_mem = {
+				      .uV = 1800000,
+				      .mode = REGULATOR_MODE_NORMAL,
+				      .enabled = 1,
+				      },
+			.state_disk = {
+				       .mode = REGULATOR_MODE_NORMAL,
+				       .enabled = 0,
+				       },
+			.always_on = 1,
+			.boot_on = 1,
+			.initial_state = PM_SUSPEND_MEM,
+			},
+};
 
-#ifdef NOT_PORTED_TO_IMX37_3STACK_YET
-static int config_gpios(struct wm8350 *wm8350)
-{
-	/* power on */
-	wm8350_gpio_config(wm8350, 0, WM8350_GPIO_DIR_IN,
-			   WM8350_GPIO0_PWR_ON_IN, WM8350_GPIO_ACTIVE_LOW,
-			   WM8350_GPIO_PULL_UP, WM8350_GPIO_INVERT_OFF,
-			   WM8350_GPIO_DEBOUNCE_ON);
-
-	/* Sw3 --> PWR_OFF_GPIO3 */
-	/* lg - TODO: GPIO1_0 to be pulled down */
-	wm8350_gpio_config(wm8350, 3, WM8350_GPIO_DIR_IN,
-			   WM8350_GPIO3_PWR_OFF_IN, WM8350_GPIO_ACTIVE_HIGH,
-			   WM8350_GPIO_PULL_DOWN, WM8350_GPIO_INVERT_OFF,
-			   WM8350_GPIO_DEBOUNCE_ON);
-
-	/* MR or MEMRST ????? */
-	wm8350_gpio_config(wm8350, 4, WM8350_GPIO_DIR_IN,
-			   WM8350_GPIO4_MR_IN, WM8350_GPIO_ACTIVE_HIGH,
-			   WM8350_GPIO_PULL_DOWN, WM8350_GPIO_INVERT_OFF,
-			   WM8350_GPIO_DEBOUNCE_OFF);
-
-	/* Hibernate -- GPIO 7 */
-	wm8350_gpio_config(wm8350, 7, WM8350_GPIO_DIR_IN,
-			   WM8350_GPIO7_HIBERNATE_IN, WM8350_GPIO_ACTIVE_HIGH,
-			   WM8350_GPIO_PULL_DOWN, WM8350_GPIO_INVERT_OFF,
-			   WM8350_GPIO_DEBOUNCE_OFF);
-
-	/* SDOUT */
-	wm8350_gpio_config(wm8350, 6, WM8350_GPIO_DIR_OUT,
-			   WM8350_GPIO6_SDOUT_OUT, WM8350_GPIO_ACTIVE_HIGH,
-			   WM8350_GPIO_PULL_NONE, WM8350_GPIO_INVERT_OFF,
-			   WM8350_GPIO_DEBOUNCE_OFF);
-
-	/* GPIO switch SW2 */
-	wm8350_gpio_config(wm8350, 7, WM8350_GPIO_DIR_IN, WM8350_GPIO7_GPIO_IN,
-			   WM8350_GPIO_ACTIVE_HIGH, WM8350_GPIO_PULL_DOWN,
-			   WM8350_GPIO_INVERT_OFF, WM8350_GPIO_DEBOUNCE_ON);
-	wm8350_register_irq(wm8350, WM8350_IRQ_GPIO(7),
-			    imx37_3stack_switch_handler, NULL);
-	wm8350_unmask_irq(wm8350, WM8350_IRQ_GPIO(7));
-
-	/* PWR_FAIL */
-	wm8350_gpio_config(wm8350, 8, WM8350_GPIO_DIR_OUT,
-			   WM8350_GPIO8_VCC_FAULT_OUT, WM8350_GPIO_ACTIVE_LOW,
-			   WM8350_GPIO_PULL_NONE, WM8350_GPIO_INVERT_OFF,
-			   WM8350_GPIO_DEBOUNCE_OFF);
-
-	/* BATT Fault */
-	wm8350_gpio_config(wm8350, 9, WM8350_GPIO_DIR_OUT,
-			   WM8350_GPIO9_BATT_FAULT_OUT, WM8350_GPIO_ACTIVE_LOW,
-			   WM8350_GPIO_PULL_NONE, WM8350_GPIO_INVERT_OFF,
-			   WM8350_GPIO_DEBOUNCE_OFF);
+static struct regulator_init_data dcdc3_data = {
+	.constraints = {
+			.name = "DCDC3",
+			.min_uV = 3300000,
+			.max_uV = 3300000,
+			.valid_modes_mask = REGULATOR_MODE_NORMAL,
+			.apply_uV = 1,
+			},
+};
 
-	return 0;
-}
+static struct regulator_init_data ldo1_data = {
+	.constraints = {
+			.name = "LDO1",
+			.min_uV = 2800000,
+			.max_uV = 2800000,
+			.valid_modes_mask = REGULATOR_MODE_NORMAL,
+			.apply_uV = 1,
+			.always_on = 1,
+			.boot_on = 1,
+			},
+};
 
-static int config_hibernate(struct wm8350 *wm8350)
-{
-	struct wm8350_pmic *pmic = &wm8350->pmic;
-
-	/* dont assert RTS when hibernating */
-	wm8350_set_bits(wm8350, WM8350_SYSTEM_HIBERNATE, WM8350_RST_HIB_MODE);
-
-	/* set up hibernate voltages -- needs refining */
-	wm8350_dcdc_set_image_voltage(pmic, WM8350_DCDC_1, 1400,	/*1200, *//* 1.0v for mx32 */
-				      WM8350_DCDC_HIB_MODE_IMAGE,
-				      WM8350_DCDC_HIB_SIG_REG);
-	wm8350_dcdc_set_image_voltage(pmic, WM8350_DCDC_3, 2800,
-				      WM8350_DCDC_HIB_MODE_IMAGE,
-				      WM8350_DCDC_HIB_SIG_REG);
-	wm8350_dcdc_set_image_voltage(pmic, WM8350_DCDC_4, 1800,
-				      WM8350_DCDC_HIB_MODE_IMAGE,
-				      WM8350_DCDC_HIB_SIG_REG);
-	wm8350_dcdc_set_image_voltage(pmic, WM8350_DCDC_6, 1800,
-				      WM8350_DCDC_HIB_MODE_IMAGE,
-				      WM8350_DCDC_HIB_SIG_REG);
-	wm8350_ldo_set_image_voltage(pmic, WM8350_LDO_1, 2800,
-				     WM8350_LDO_HIB_MODE_IMAGE,
-				     WM8350_LDO_HIB_SIG_REG);
-	wm8350_ldo_set_image_voltage(pmic, WM8350_LDO_2, 3300,
-				     WM8350_LDO_HIB_MODE_IMAGE,
-				     WM8350_LDO_HIB_SIG_REG);
-	wm8350_ldo_set_image_voltage(pmic, WM8350_LDO_3, 1500,
-				     WM8350_LDO_HIB_MODE_IMAGE,
-				     WM8350_LDO_HIB_SIG_REG);
-	wm8350_ldo_set_image_voltage(pmic, WM8350_LDO_4, 2500,
-				     WM8350_LDO_HIB_MODE_IMAGE,
-				     WM8350_LDO_HIB_MODE_DIS);
-	return 0;
-}
-#endif
+static struct regulator_init_data ldo2_data = {
+	.constraints = {
+			.name = "LDO2",
+			.min_uV = 2500000,
+			.max_uV = 2500000,
+			.valid_modes_mask = REGULATOR_MODE_NORMAL,
+			.apply_uV = 1,
+			.always_on = 1,
+			.boot_on = 1,
+			},
+};
 
-struct regulation_constraints led_regulation_constraints = {
-	.min_uA = 0,
-	.max_uA = 230000,
-	.valid_ops_mask = REGULATOR_CHANGE_CURRENT,
+static struct regulator_init_data ldo3_data = {
+	.constraints = {
+			.name = "LDO3",
+			.min_uV = 1200000,
+			.max_uV = 1200000,
+			.valid_modes_mask = REGULATOR_MODE_NORMAL,
+			.apply_uV = 1,
+			.always_on = 1,
+			.boot_on = 1,
+			},
 };
-struct regulation_constraints dcdc1_regulation_constraints = {
-	.min_uV = mV_to_uV(850),
-	.max_uV = mV_to_uV(1200),
-	.valid_ops_mask = REGULATOR_CHANGE_VOLTAGE | REGULATOR_CHANGE_MODE,
+
+static struct regulator_init_data ldo4_data = {
+	.constraints = {
+			.name = "LDO4",
+			.min_uV = 1800000,
+			.max_uV = 1800000,
+			.valid_modes_mask = REGULATOR_MODE_NORMAL,
+			.apply_uV = 1,
+			.always_on = 1,
+			.boot_on = 1,
+			},
 };
-struct regulation_constraints dcdc4_regulation_constraints = {
-	.min_uV = mV_to_uV(1000),
-	.max_uV = mV_to_uV(1200),
-	.valid_ops_mask = REGULATOR_CHANGE_VOLTAGE | REGULATOR_CHANGE_MODE,
+
+static struct regulator_init_data isinka_data = {
+	.constraints = {
+			.name = "ISINKA",
+			.min_uA = 0,
+			.max_uA = 225000,
+			.valid_ops_mask = REGULATOR_CHANGE_CURRENT,
+			.valid_modes_mask = REGULATOR_MODE_NORMAL,
+			},
 };
 
-static void set_regulator_constraints(struct wm8350 *wm8350)
-{
-	regulator_set_platform_constraints("DCDC1",
-					   &dcdc1_regulation_constraints);
-	regulator_set_platform_constraints("DCDC4",
-					   &dcdc4_regulation_constraints);
-	regulator_set_platform_constraints("ISINKA",
-					   &led_regulation_constraints);
-}
+static struct regulator_init_data dcdc5_data = {
+	.constraints = {
+			.name = "DCDC5",
+			.min_uV = 0,
+			.max_uV = 5000000,
+			.valid_modes_mask = REGULATOR_MODE_NORMAL,
+			},
+};
 
 static void wm8350_nop_release(struct device *dev)
 {
@@ -290,30 +202,17 @@ static struct platform_device mxc_wm8350_devices[] = {
 	 },
 };
 
-static inline void mxc_init_wm8350(void)
+static int mx37_wm8350_init(struct wm8350 *wm8350)
 {
-	int i;
+	int i, ret;
 
 	for (i = 0; i < ARRAY_SIZE(mxc_wm8350_devices); i++) {
 		if (platform_device_register(&mxc_wm8350_devices[i]) < 0)
 			dev_err(&mxc_wm8350_devices[i].dev,
 				"Unable to register WM8350 device\n");
 	}
-}
 
-int wm8350_init(struct wm8350 *wm8350)
-{
-	int ret = 0;
-
-	/* register regulator and set constraints */
-	wm8350_device_register_pmic(wm8350);
-	set_regulator_constraints(wm8350);
-#ifdef NOT_PORTED_TO_IMX37
-	wm8350_device_register_rtc(wm8350);
-	wm8350_device_register_wdg(wm8350);
-	wm8350_device_register_power(wm8350);
-#endif
-	mxc_init_wm8350();
+	wm8350->pmic.isink_A_dcdc = WM8350_DCDC_5;
 
 	/*Note: Needs to be moved into a regulator function. */
 	/* Configuring -- GPIO 7 pin */
@@ -321,7 +220,7 @@ int wm8350_init(struct wm8350 *wm8350)
 			       WM8350_GPIO_ACTIVE_LOW, WM8350_GPIO_PULL_NONE,
 			       WM8350_GPIO_INVERT_OFF,
 			       WM8350_GPIO_DEBOUNCE_OFF) == 0)
-		wm8350_gpio_set_status(wm8350, 7, 1);
+		wm8350_set_bits(wm8350, WM8350_GPIO_PIN_STATUS, 1 << 7);
 	else
 		printk(KERN_ERR "Error in setting Wolfson GPIO pin 7 \n");
 	/* enable gpio4:USB_VBUS_EN */
@@ -333,63 +232,74 @@ int wm8350_init(struct wm8350 *wm8350)
 	if (ret)
 		printk(KERN_ERR "Error in setting USB VBUS enable pin\n");
 
-	/* register sound */
-	printk("Registering imx37_snd_device");
-	imx_snd_device = platform_device_alloc("wm8350-imx-3stack-audio", -1);
-	if (!imx_snd_device) {
-		ret = -ENOMEM;
-		goto err;
-	}
-	imx_snd_device->dev.platform_data = &imx_3stack_audio_platform_data;
-	platform_set_drvdata(imx_snd_device, &wm8350->audio);
-	ret = platform_device_add(imx_snd_device);
-	if (ret)
-		goto snd_err;
-
-	/* set up PMIC IRQ (active high) to i.MX32ADS */
-#ifdef NOT_PORTED_TO_IMX37
-	printk("Registering PMIC INT");
-	INIT_WORK(&wm8350->work, wm8350_irq_work);
-	wm8350_reg_unlock(wm8350);
-	wm8350_set_bits(wm8350, WM8350_SYSTEM_CONTROL_1, WM8350_IRQ_POL);
-	wm8350_reg_lock(wm8350);
-	set_irq_type(MXC_PMIC_INT_LINE, IRQF_TRIGGER_RISING);
-	ret = request_irq(MXC_PMIC_INT_LINE, wm8350_irq_handler,
-			  IRQF_DISABLED, "wm8350-pmic", wm8350);
-	if (ret != 0) {
-		printk(KERN_ERR "wm8350: cant request irq %d\n",
-		       MXC_PMIC_INT_LINE);
-		goto err;
+	wm8350_register_regulator(wm8350, WM8350_DCDC_1, &dcdc1_data);
+	wm8350_register_regulator(wm8350, WM8350_DCDC_3, &dcdc3_data);
+	wm8350_register_regulator(wm8350, WM8350_DCDC_4, &dcdc4_data);
+	wm8350_register_regulator(wm8350, WM8350_DCDC_5, &dcdc5_data);
+	wm8350_register_regulator(wm8350, WM8350_DCDC_6, &dcdc6_data);
+	wm8350_register_regulator(wm8350, WM8350_LDO_1, &ldo1_data);
+	wm8350_register_regulator(wm8350, WM8350_LDO_2, &ldo2_data);
+	wm8350_register_regulator(wm8350, WM8350_LDO_3, &ldo3_data);
+	wm8350_register_regulator(wm8350, WM8350_LDO_4, &ldo4_data);
+	wm8350_register_regulator(wm8350, WM8350_ISINK_A, &isinka_data);
+
+	return 0;
+}
+
+struct wm8350_platform_data __initdata mx37_wm8350_pdata = {
+	.init = mx37_wm8350_init,
+};
+
+static struct i2c_board_info __initdata wm8350_i2c_device = {
+	I2C_BOARD_INFO("wm8350", 0x1a),
+	.platform_data = &mx37_wm8350_pdata,
+//	.irq = IOMUX_TO_IRQ(MX31_PIN_GPIO1_3),
+};
+
+static __init int mxc_init_i2c(void)
+{
+	i2c_register_board_info(1, &wm8350_i2c_device, 1);
+	return 0;
+}
+
+subsys_initcall(mxc_init_i2c);
+
+static __init int wm8350_regulator_init(void)
+{
+	int i = 0;
+	struct regulator *regulator;
+	char *wm8350_global_regulator[] = {
+		"DCDC1",
+		"DCDC3",
+		"DCDC4",
+		"DCDC6",
+		"LDO3",
+	};
+
+	/* for board v2.0 later, do nothing here */
+	if (board_is_mx37(BOARD_REV_2))
+		return 0;
+	while (!IS_ERR_VALUE(
+			(unsigned long)(regulator =
+					regulator_get(NULL,
+						wm8350_global_regulator
+						[i])))) {
+		regulator_enable(regulator);
+		i++;
 	}
-	wm8350->nirq = MXC_PMIC_INT_LINE;
-	printk("Configuring WM8350 GPIOS");
-	config_gpios(wm8350);
-	config_hibernate(wm8350);
-
-	/* Sw1 --> PWR_ON */
-	printk("Registering and unmasking the WM8350 wakeup key");
-	wm8350_register_irq(wm8350, WM8350_IRQ_WKUP_ONKEY,
-			    imx37_3stack_switch_handler);
-	wm8350_unmask_irq(wm8350, WM8350_IRQ_WKUP_ONKEY);
-
-	/* unmask all & clear sticky */
-	printk("Unmasking WM8350 local interrupts");
-	wm8350_reg_write(wm8350, WM8350_SYSTEM_INTERRUPTS_MASK, 0x0);
-	schedule_work(&wm8350->work);
-#endif
-
-#if BATTERY
-	/* not much use without a battery atm */
-	wm8350_init_battery(wm8350);
-#endif
-
-	printk("Exiting normally from wm8350_init()");
-	return ret;
-      snd_err:
-	platform_device_put(imx_snd_device);
-
-      err:
-	printk("wm8350_init() FAILED");
-	kfree(wm8350->reg_cache);
-	return ret;
+	return 0;
 }
+
+late_initcall(wm8350_regulator_init);
+
+/* extern const char imx_3stack_audio[32]; */
+
+struct mxc_audio_platform_data imx_3stack_audio_platform_data = {
+	.ssi_num = 2,
+	.src_port = 2,
+	.ext_port = 5,
+	.regulator1 = "DCDC6",
+	.regulator2 = "DCDC3"
+};
+
+static struct platform_device *imx_snd_device;
-- 
1.5.4.4

