From 6b81c9846ac37886a08c797f07d3abb1135424e6 Mon Sep 17 00:00:00 2001
From: Jason <r64343@freescale.com>
Date: Tue, 26 May 2009 19:34:27 +0800
Subject: [PATCH] ENGR00112804 Litmit nand size to 2G for stmp3780

Litmit nand size to 2G for stmp3780

Signed-off-by:Jason Liu <r64343@freescale.com>
---
 drivers/mtd/nand/gpmi/gpmi-base.c |    6 ++++++
 1 files changed, 6 insertions(+), 0 deletions(-)

diff --git a/drivers/mtd/nand/gpmi/gpmi-base.c b/drivers/mtd/nand/gpmi/gpmi-base.c
index 36107f2..547dec9 100644
--- a/drivers/mtd/nand/gpmi/gpmi-base.c
+++ b/drivers/mtd/nand/gpmi/gpmi-base.c
@@ -1108,6 +1108,12 @@ static int gpmi_scan_middle(struct gpmi_nand_data *g)
 {
 	int oobsize = 0;
 
+	/* Limit to 2G size due to Kernel larger 4G space support */
+	if (g->mtd.size == 0) {
+		g->mtd.size = 1 << 31;
+		g->chip.chipsize = g->mtd.size / g->chip.numchips;
+	}
+
 	g->ecc_oob_bytes = 9;
 	switch (g->mtd.writesize) {
 	case 2048:	/* 2K page */
-- 
1.5.4.4

